<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Buffs & Debuffs — Balanceador</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#111824;
      --text:#e7eef8;
      --muted:#9fb0c6;
      --border:#223247;
      --ok:#2ee59d;
      --bad:#ff5d5d;
      --warn:#ffcc66;
      --chip:#162235;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      background: radial-gradient(1200px 700px at 20% -10%, rgba(46,229,157,.12), transparent 55%),
                  radial-gradient(900px 600px at 110% 10%, rgba(116,140,255,.10), transparent 60%),
                  var(--bg);
      color:var(--text);
      font: 14px/1.35 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
    }
    header{
      position:sticky; top:0; z-index:10;
      background: linear-gradient(to bottom, rgba(11,15,20,.95), rgba(11,15,20,.78));
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(34,50,71,.65);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:18px 16px;}
    h1{margin:0; font-size:18px; letter-spacing:.2px}
    .sub{margin-top:6px; color:var(--muted); font-size:12.5px}
    .topbar{
      display:grid; gap:12px;
      grid-template-columns: 1.2fr 1fr;
      align-items:start;
    }
    @media (max-width:900px){ .topbar{grid-template-columns:1fr;} }
    .panel{
      background: linear-gradient(180deg, rgba(17,24,36,.95), rgba(15,22,32,.95));
      border: 1px solid rgba(34,50,71,.75);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
    }
    .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    .chip{
      background: rgba(22,34,53,.9);
      border:1px solid rgba(34,50,71,.85);
      padding:8px 10px;
      border-radius:999px;
      display:flex;
      gap:8px;
      align-items:center;
      color:var(--text);
      min-height:34px;
    }
    .chip b{font-weight:700}
    .status{
      font-weight:700;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(34,50,71,.85);
      background: rgba(22,34,53,.65);
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .status.ok{color:var(--ok); border-color: rgba(46,229,157,.35); background: rgba(46,229,157,.08);}
    .status.bad{color:var(--bad); border-color: rgba(255,93,93,.35); background: rgba(255,93,93,.08);}
    .status.warn{color:var(--warn); border-color: rgba(255,204,102,.35); background: rgba(255,204,102,.08);}
    .btn{
      cursor:pointer;
      border-radius:12px;
      border:1px solid rgba(34,50,71,.85);
      background: rgba(22,34,53,.75);
      color:var(--text);
      padding:10px 12px;
      font-weight:700;
      letter-spacing:.15px;
      transition: transform .05s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:hover{background: rgba(22,34,53,.95)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      border-color: rgba(46,229,157,.45);
      background: rgba(46,229,157,.14);
    }
    .btn.primary:hover{background: rgba(46,229,157,.18)}
    .btn:disabled{
      opacity:.45; cursor:not-allowed; transform:none;
    }
    .grid{
      margin-top:14px;
      display:grid;
      gap:14px;
      grid-template-columns: 1fr 1fr;
    }
    @media (max-width:900px){ .grid{grid-template-columns:1fr;} }
    .colTitle{
      display:flex; align-items:center; justify-content:space-between;
      margin-bottom:10px;
    }
    .colTitle h2{margin:0; font-size:15px}
    .search{
      width:100%;
      padding:10px 12px;
      background: rgba(9,13,18,.45);
      border:1px solid rgba(34,50,71,.75);
      border-radius:12px;
      color:var(--text);
      outline:none;
    }
    .list{
      margin-top:10px;
      display:grid;
      gap:10px;
      max-height: 62vh;
      overflow:auto;
      padding-right:4px;
    }
    .item{
      display:grid;
      grid-template-columns: 22px 1fr auto;
      gap:10px;
      align-items:center;
      padding:10px 10px;
      border-radius: 14px;
      border:1px solid rgba(34,50,71,.75);
      background: rgba(9,13,18,.35);
    }
    .item.disabled{
      opacity:.55;
      background: rgba(9,13,18,.25);
    }
    .nameLine{
      display:flex; align-items:baseline; gap:10px; flex-wrap:wrap;
    }
    .nameLine .name{font-weight:800}
    .pill{
      font-size:12px;
      padding:3px 8px;
      border-radius:999px;
      background: rgba(22,34,53,.75);
      border: 1px solid rgba(34,50,71,.75);
      color: var(--muted);
    }
    select{
      background: rgba(22,34,53,.75);
      border: 1px solid rgba(34,50,71,.75);
      border-radius: 12px;
      color: var(--text);
      padding:8px 10px;
      outline:none;
      cursor:pointer;
    }
    .footer{
      margin-top:10px;
      color:var(--muted);
      font-size:12px;
    }
    textarea{
      width:100%;
      min-height:90px;
      resize:vertical;
      padding:10px 12px;
      background: rgba(9,13,18,.45);
      border:1px solid rgba(34,50,71,.75);
      border-radius:12px;
      color:var(--text);
      outline:none;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12.5px;
    }
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="topbar">
        <div>
          <h1>Menu de Buffs & Debuffs (balanceamento)</h1>
          <div class="sub">
            Regra: buffs somam positivo, debuffs somam negativo. O total precisa ficar <b>0 ou menos</b>.
            Antíteses se bloqueiam (ex.: buff de Infraestrutura bloqueia debuff de Infraestrutura; Adaptação bloqueia Vulnerabilidade correspondente).
          </div>
        </div>
        <div class="panel">
          <div class="row" style="justify-content:space-between; gap:12px;">
            <div class="chip"><span>Total</span> <b id="totalValue">0</b></div>
            <div class="status ok" id="statusPill">OK (<= 0)</div>
            <button class="btn" id="clearBtn" type="button">Limpar</button>
            <button class="btn primary" id="copyBtn" type="button">Copiar lista</button>
          </div>
          <div style="margin-top:10px;">
            <div class="small">Prévia / texto copiado:</div>
            <textarea id="exportBox" placeholder="Clique em “Copiar lista”." spellcheck="false"></textarea>
            <div class="footer">
              Intensidades: <b>Alta</b>=2×, <b>Muito Alta</b>=3×, <b>Insana</b>=5×, <b>Extrema</b>=7×.
              (Você pode selecionar qualquer item; o bloqueio só ocorre quando existe antítese escolhida.)
            </div>
          </div>
        </div>
      </div>

      <div class="grid">
        <section class="panel">
          <div class="colTitle">
            <h2>Buffs</h2>
            <span class="pill" id="buffCount">0 selecionados</span>
          </div>
          <input id="buffSearch" class="search" placeholder="Buscar buff..." />
          <div class="list" id="buffList"></div>
        </section>

        <section class="panel">
          <div class="colTitle">
            <h2>Debuffs</h2>
            <span class="pill" id="debuffCount">0 selecionados</span>
          </div>
          <input id="debuffSearch" class="search" placeholder="Buscar debuff..." />
          <div class="list" id="debuffList"></div>
        </section>
      </div>
    </div>
  </header>

  <script>
    // ---------- Dados ----------
    const MULTS = { "Alta":2, "Muito Alta":3, "Insana":5, "Extrema":7 };
    const TIERS = Object.keys(MULTS);

    const BUFFS = [
      { name:"Marinha", base:3 },
      { name:"População", base:6 },
      { name:"Cavalaria", base:4 },
      { name:"Agricultura", base:2 },
      { name:"Disciplina", base:3 },
      { name:"Força Física", base:3 },
      { name:"Infraestrutura geral", base:3 },
      { name:"Fortificações", base:4 },
      { name:"Pecuária", base:2 },
      { name:"Estabilidade", base:4 },
      { name:"Inovação e Tecnologia", base:5 },
      { name:"Arquitetura monumental", base:2 },
      { name:"Adaptação ao deserto", base:4 },
      { name:"Adaptação a neve", base:4 },
      { name:"Adaptação a floresta", base:4 },
      { name:"Adaptação a montanha", base:4 },
      { name:"Ataque surpresa", base:3 },
      { name:"Mobilidade de infantaria", base:3 },
      { name:"Arquearia", base:3 },
      { name:"Comércio", base:3 }
    ];

    const DEBUFFS = [
      { name:"Marinha", base:2 },
      { name:"População", base:4 },
      { name:"Cavalaria", base:3 },
      { name:"Agricultura", base:3 },
      { name:"Disciplina", base:4 },
      { name:"Força Física", base:3 },
      { name:"Infraestrutura geral", base:4 },
      { name:"Fortificações", base:3 },
      { name:"Pecuária", base:2 },
      { name:"Crises amplificadas", base:6 },
      { name:"Inovação e Tecnologia", base:4 },
      { name:"Vulnerabilidade ao deserto", base:2 },
      { name:"Vulnerabilidade a neve", base:2 },
      { name:"Vulnerabilidade a floresta", base:2 },
      { name:"Vulnerabilidade a montanha", base:2 },
      { name:"Ataque surpresa", base:1 },
      { name:"Mobilidade de infantaria", base:3 },
      { name:"Arquearia", base:2 },
      { name:"Corrupção", base:4 },
      { name:"Dependência de elites", base:3 },
      { name:"Dependência de comércio", base:4 }
    ];

    function norm(s){
      return s
        .toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
        .replace(/[^a-z0-9]+/g," ")
        .trim()
        .replace(/\s+/g," ");
    }
    const buffKey = (name)=>"buff:" + norm(name);
    const debuffKey = (name)=>"debuff:" + norm(name);

    // ---------- Antíteses (bloqueios) ----------
    // Mapa: keySelecionada -> Set(keys que ficam proibidas)
    const forbidden = new Map();
    const addForbidden = (a,b)=>{
      if(!forbidden.has(a)) forbidden.set(a, new Set());
      forbidden.get(a).add(b);
    };

    // 1) Mesmo tema: buff X bloqueia debuff X, e vice-versa
    for(const b of BUFFS){
      const bk = buffKey(b.name);
      const dk = debuffKey(b.name);
      addForbidden(bk, dk);
      addForbidden(dk, bk);
    }

    // 2) Pares especiais
    const link = (buffName, debuffName)=>{
      const bk = buffKey(buffName);
      const dk = debuffKey(debuffName);
      addForbidden(bk, dk);
      addForbidden(dk, bk);
    };

    link("Adaptação ao deserto", "Vulnerabilidade ao deserto");
    link("Adaptação a neve", "Vulnerabilidade a neve");
    link("Adaptação a floresta", "Vulnerabilidade a floresta");
    link("Adaptação a montanha", "Vulnerabilidade a montanha");
    link("Estabilidade", "Crises amplificadas");
    link("Comércio", "Dependência de comércio");

    // ---------- Estado ----------
    // selections: Map(key -> {kind,name,base,tier})
    const selections = new Map();

    // ---------- UI ----------
    const buffList = document.getElementById("buffList");
    const debuffList = document.getElementById("debuffList");
    const buffSearch = document.getElementById("buffSearch");
    const debuffSearch = document.getElementById("debuffSearch");

    const totalValueEl = document.getElementById("totalValue");
    const statusPill = document.getElementById("statusPill");
    const exportBox = document.getElementById("exportBox");
    const copyBtn = document.getElementById("copyBtn");
    const clearBtn = document.getElementById("clearBtn");
    const buffCount = document.getElementById("buffCount");
    const debuffCount = document.getElementById("debuffCount");

    function calcItemValue(kind, base, tier){
      const mult = MULTS[tier] ?? 1;
      const v = base * mult;
      return kind === "buff" ? v : -v;
    }

    function computeTotals(){
      let total = 0;
      let b = 0;
      let d = 0;
      for(const item of selections.values()){
        total += calcItemValue(item.kind, item.base, item.tier);
        if(item.kind === "buff") b++; else d++;
      }
      return { total, b, d };
    }

    function getBlockedKeys(){
      const blocked = new Set();
      for(const [k] of selections.entries()){
        const set = forbidden.get(k);
        if(!set) continue;
        for(const otherKey of set) blocked.add(otherKey);
      }
      return blocked;
    }

    function makeTierSelect(currentTier){
      const sel = document.createElement("select");
      for(const t of TIERS){
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t + " (" + MULTS[t] + "×)";
        if(t === currentTier) opt.selected = true;
        sel.appendChild(opt);
      }
      return sel;
    }

    function enforceBlocks(){
      // remove itens que ficaram proibidos por algum selecionado
      const blocked = getBlockedKeys();
      for(const k of blocked){
        if(selections.has(k)){
          selections.delete(k);
        }
      }
    }

    function tierToLower(t){
      // "Muito Alta" -> "muito alta"
      return (t || "").toLowerCase();
    }

    function buildCopyText(){
      const buffs = [];
      const debuffs = [];
      for(const item of selections.values()){
        const line = `${item.name} ${tierToLower(item.tier)}`;
        if(item.kind === "buff") buffs.push(line);
        else debuffs.push(line);
      }
      buffs.sort((a,b)=>a.localeCompare(b,"pt-BR"));
      debuffs.sort((a,b)=>a.localeCompare(b,"pt-BR"));

      const { total } = computeTotals();

      const out =
`Buffs:
${buffs.length ? buffs.map(x=>"- " + x).join("\n") : "- (nenhum)"}

Debuffs:
${debuffs.length ? debuffs.map(x=>"- " + x).join("\n") : "- (nenhum)"}

Total: ${total}  (${total <= 0 ? "válido" : "inválido"})`;

      return out;
    }

    async function copyToClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
        statusPill.className = "status ok";
        statusPill.textContent = "Copiado!";
        setTimeout(()=>render(), 900);
      }catch{
        // fallback: usuário pode copiar manualmente da textarea
        statusPill.className = "status warn";
        statusPill.textContent = "Não consegui copiar automaticamente";
        setTimeout(()=>render(), 1200);
      }
    }

    function render(){
      const { total, b, d } = computeTotals();
      totalValueEl.textContent = String(total);

      buffCount.textContent = `${b} selecionados`;
      debuffCount.textContent = `${d} selecionados`;

      if(total <= 0){
        statusPill.className = "status ok";
        statusPill.textContent = "OK (<= 0)";
      } else {
        statusPill.className = "status bad";
        statusPill.textContent = `Precisa de ${total} ou mais em debuffs`;
      }

      const blocked = getBlockedKeys();
      const bq = norm(buffSearch.value || "");
      const dq = norm(debuffSearch.value || "");

      buffList.innerHTML = "";
      debuffList.innerHTML = "";

      // Buffs
      for(const bItem of BUFFS){
        const k = buffKey(bItem.name);
        const kSearch = norm(bItem.name);
        if(bq && !kSearch.includes(bq)) continue;

        const row = document.createElement("div");
        row.className = "item";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = selections.has(k);

        const isBlocked = blocked.has(k) && !cb.checked;
        cb.disabled = isBlocked;
        if(isBlocked) row.classList.add("disabled");

        const mid = document.createElement("div");
        const nameLine = document.createElement("div");
        nameLine.className = "nameLine";

        const nm = document.createElement("div");
        nm.className = "name";
        nm.textContent = bItem.name;

        const pill = document.createElement("span");
        pill.className = "pill";
        pill.textContent = "Base +" + bItem.base;

        nameLine.appendChild(nm);
        nameLine.appendChild(pill);
        mid.appendChild(nameLine);

        const right = document.createElement("div");
        const currentTier = selections.has(k) ? selections.get(k).tier : "Alta";
        const tierSel = makeTierSelect(currentTier);
        tierSel.disabled = !cb.checked;

        cb.addEventListener("change", () => {
          if(cb.checked){
            selections.set(k, { kind:"buff", name:bItem.name, base:bItem.base, tier:tierSel.value });
          } else {
            selections.delete(k);
          }
          enforceBlocks();
          render();
        });

        tierSel.addEventListener("change", () => {
          if(selections.has(k)){
            selections.get(k).tier = tierSel.value;
            enforceBlocks();
            render();
          }
        });

        right.appendChild(tierSel);
        row.appendChild(cb);
        row.appendChild(mid);
        row.appendChild(right);
        buffList.appendChild(row);
      }

      // Debuffs
      for(const dItem of DEBUFFS){
        const k = debuffKey(dItem.name);
        const kSearch = norm(dItem.name);
        if(dq && !kSearch.includes(dq)) continue;

        const row = document.createElement("div");
        row.className = "item";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = selections.has(k);

        const isBlocked = blocked.has(k) && !cb.checked;
        cb.disabled = isBlocked;
        if(isBlocked) row.classList.add("disabled");

        const mid = document.createElement("div");
        const nameLine = document.createElement("div");
        nameLine.className = "nameLine";

        const nm = document.createElement("div");
        nm.className = "name";
        nm.textContent = dItem.name;

        const pill = document.createElement("span");
        pill.className = "pill";
        pill.textContent = "Base -" + dItem.base;

        nameLine.appendChild(nm);
        nameLine.appendChild(pill);
        mid.appendChild(nameLine);

        const right = document.createElement("div");
        const currentTier = selections.has(k) ? selections.get(k).tier : "Alta";
        const tierSel = makeTierSelect(currentTier);
        tierSel.disabled = !cb.checked;

        cb.addEventListener("change", () => {
          if(cb.checked){
            selections.set(k, { kind:"debuff", name:dItem.name, base:dItem.base, tier:tierSel.value });
          } else {
            selections.delete(k);
          }
          enforceBlocks();
          render();
        });

        tierSel.addEventListener("change", () => {
          if(selections.has(k)){
            selections.get(k).tier = tierSel.value;
            enforceBlocks();
            render();
          }
        });

        right.appendChild(tierSel);
        row.appendChild(cb);
        row.appendChild(mid);
        row.appendChild(right);
        debuffList.appendChild(row);
      }
    }

    buffSearch.addEventListener("input", render);
    debuffSearch.addEventListener("input", render);

    copyBtn.addEventListener("click", async () => {
      const text = buildCopyText();
      exportBox.value = text;
      exportBox.focus();
      exportBox.select();
      await copyToClipboard(text);
    });

    clearBtn.addEventListener("click", () => {
      selections.clear();
      exportBox.value = "";
      render();
    });

    render();
  </script>
</body>
</html>
